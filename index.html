<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>汽车运行日志数据分析平台</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .hero-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 3rem;
            margin: 2rem 0;
            color: white;
        }
        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: none;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        /* 统计卡片容器样式 */
        .stats-container {
            display: flex !important;
            flex-direction: row !important;
            justify-content: space-between !important;
            align-items: stretch !important;
            gap: 1rem !important;
            flex-wrap: nowrap !important;
            width: 100% !important;
        }
        
        /* 确保统计卡片默认隐藏 */
        .stats-container[style*="display: none"] {
            display: none !important;
        }
        
        /* 确保下拉菜单在最上层 */
        .dropdown-menu {
            z-index: 9999 !important;
            position: absolute !important;
        }
        
        /* 英雄区域按钮组 */
        .hero-section .btn-group {
            position: relative !important;
            z-index: 1000 !important;
        }
        
        /* 统计容器设置较低层级 */
        .stats-container {
            position: relative !important;
            z-index: 1 !important;
        }
        
        /* 确保下拉菜单不被遮挡 */
        .dropdown.show .dropdown-menu {
            z-index: 99999 !important;
            position: absolute !important;
            transform: none !important;
        }
        
        /* 强制下拉菜单在最上层 */
        .dropdown-menu.show {
            z-index: 999999 !important;
            position: absolute !important;
        }
        
        /* 所有下拉菜单都要在最上层 */
        .dropdown-menu {
            z-index: 99999 !important;
            position: absolute !important;
        }
        
        /* 按钮组样式优化 */
        .hero-section .d-flex {
            margin-bottom: 4rem;
        }
        
        /* 所有按钮组的z-index */
        .hero-section .btn-group {
            position: relative !important;
            z-index: 1000 !important;
        }
        
        /* 功能特性卡片保持低层级 */
        .card {
            position: relative !important;
            z-index: 1 !important;
        }
        
        /* 确保功能特性区域不会干扰下拉菜单 */
        .row.mt-5 {
            position: relative !important;
            z-index: 1 !important;
        }
        
        /* 强制所有下拉菜单在最上层，使用最高优先级 */
        .dropdown-menu,
        .dropdown-menu.show,
        .dropdown.show .dropdown-menu {
            z-index: 999999 !important;
            position: absolute !important;
            transform: none !important;
        }
        
        /* 确保统计卡片不会遮挡下拉菜单 */
        .stats-container,
        .stats-container .stat-card {
            position: relative !important;
            z-index: 1 !important;
        }
        
        /* 使用CSS变量确保层级一致性 */
        :root {
            --dropdown-z-index: 999999;
            --button-z-index: 1000;
            --content-z-index: 1;
        }
        
        /* 最高优先级的下拉菜单规则 */
        body .dropdown-menu,
        body .dropdown-menu.show,
        body .dropdown.show .dropdown-menu,
        body .hero-section .dropdown-menu,
        body .hero-section .dropdown-menu.show {
            z-index: 999999 !important;
            position: absolute !important;
            transform: none !important;
            pointer-events: auto !important;
        }
        
        /* 确保所有内容元素都在下拉菜单下方 */
        body .stats-container,
        body .row.mt-5,
        body .card {
            z-index: 1 !important;
            position: relative !important;
        }
        
        /* 统计卡片样式 */
        .stat-card {
            text-align: center !important;
            padding: 1.5rem !important;
            flex: 1 !important;
            min-width: 200px !important;
            max-width: 250px !important;
            margin: 0 !important;
            display: block !important;
            position: relative !important;
            z-index: 1 !important;
        }
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #667eea;
        }
        .stat-label {
            color: #6c757d;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .data-table {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        .table th {
            background: #667eea;
            color: white;
            border: none;
            font-weight: 600;
        }
        .table td {
            vertical-align: middle;
        }
        .btn-custom {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            border-radius: 25px;
            padding: 0.75rem 2rem;
            color: white;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .btn-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            color: white;
        }
        .feature-icon {
            font-size: 3rem;
            color: #667eea;
            margin-bottom: 1rem;
        }
        .loading {
            display: none;
        }
        .chart-container {
            height: 400px;
            margin: 2rem 0;
        }
        
        .stats-container {
            display: flex !important;
            flex-direction: row !important;
            justify-content: space-between !important;
            align-items: stretch !important;
            gap: 1rem !important;
            flex-wrap: nowrap !important;
            width: 100% !important;
        }
        
        .stat-card {
            text-align: center !important;
            padding: 1.5rem !important;
            flex: 1 !important;
            min-width: 200px !important;
            max-width: 250px !important;
            margin: 0 !important;
            display: block !important;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <!-- 英雄区域 -->
        <div class="hero-section text-center">
            <h1 class="display-4 mb-4">
                <i class="bi bi-car-front"></i> 汽车运行日志数据分析平台
            </h1>
            <p class="lead mb-4">
                基于事务型事实表和周期型快照事实表的智能车辆监控系统
            </p>
            <div class="row justify-content-center">
                <div class="col-md-8">
                    <p class="text-light">
                        本平台展示去敏后的汽车运行日志数据，包含车辆状态、电池信息、电机性能等关键指标，
                        支持实时监控和趋势分析，为车辆管理和维护提供数据支撑。
                    </p>
                </div>
            </div>
            <div class="d-flex justify-content-center align-items-center gap-3 mb-4">
                <button class="btn btn-custom btn-lg" onclick="loadData()">
                    <i class="bi bi-play-circle"></i> 加载数据
                </button>
                <div class="btn-group" role="group">
                    <button class="btn btn-outline-light btn-lg" onclick="exportData()">
                        <i class="bi bi-download"></i> 导出CSV
                    </button>
                    <button type="button" class="btn btn-outline-light btn-lg dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown">
                        <span class="visually-hidden">导出选项</span>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><a class="dropdown-item" href="#" onclick="exportData('csv')">导出CSV (UTF-8)</a></li>
                        <li><a class="dropdown-item" href="#" onclick="exportData('csv-gbk')">导出CSV (GBK)</a></li>
                        <li><a class="dropdown-item" href="#" onclick="exportData('json')">导出JSON</a></li>
                        <li><a class="dropdown-item" href="#" onclick="exportData('excel')">导出Excel格式</a></li>
                    </ul>
                </div>
                <button class="btn btn-outline-light btn-lg" onclick="showConfig()">
                    <i class="bi bi-gear"></i> 配置
                </button>
                <div class="btn-group" role="group">
                    <button class="btn btn-outline-light btn-lg" onclick="downloadOriginalDataset()">
                        <i class="bi bi-file-earmark-zip"></i> 下载原始压缩包
                    </button>
                    <button type="button" class="btn btn-outline-light btn-lg dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown">
                        <span class="visually-hidden">下载选项</span>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><a class="dropdown-item" href="#" onclick="downloadOriginalDataset()">下载原始压缩包 (.7z)</a></li>
                        <li><a class="dropdown-item" href="#" onclick="downloadFullDataset()">下载当前数据包 (.zip)</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#" onclick="downloadDataAsJSON()">仅下载JSON数据</a></li>
                        <li><a class="dropdown-item" href="#" onclick="downloadDataAsCSV()">仅下载CSV数据</a></li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- 数据概览 -->
        <div class="stats-container mb-4 mt-4" id="statsSection" style="display: none;">
            <div class="card stat-card">
                <div class="stat-number" id="totalRecords">0</div>
                <div class="stat-label">总记录数</div>
            </div>
            <div class="card stat-card">
                <div class="stat-number" id="uniqueVehicles">0</div>
                <div class="stat-label">车辆数量</div>
            </div>
            <div class="card stat-card">
                <div class="stat-number" id="avgSpeed">0</div>
                <div class="stat-label">平均车速(km/h)</div>
            </div>
            <div class="card stat-card">
                <div class="stat-number" id="avgSOC">0</div>
                <div class="stat-label">平均电量(%)</div>
            </div>
        </div>

        <!-- 加载状态 -->
        <div class="text-center loading" id="loadingSection">
            <div class="spinner-border text-light" role="status">
                <span class="visually-hidden">加载中...</span>
            </div>
            <p class="text-light mt-3">正在解析日志数据，请稍候...</p>
        </div>

        <!-- 数据表格 -->
        <div class="card data-table" id="dataSection" style="display: none;">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">
                    <i class="bi bi-table"></i> 车辆运行数据详情
                </h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover" id="dataTable">
                        <thead>
                            <tr>
                                <th>车辆VIN</th>
                                <th>时间戳</th>
                                <th>车辆状态</th>
                                <th>充电状态</th>
                                <th>执行模式</th>
                                <th>车速(km/h)</th>
                                <th>里程(km)</th>
                                <th>电压(V)</th>
                                <th>电流(A)</th>
                                <th>电量(%)</th>
                                <th>档位</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- 功能特性 -->
        <div class="row mt-5">
            <div class="col-md-4 text-center mb-4">
                <div class="card h-100">
                    <div class="card-body">
                        <i class="bi bi-speedometer2 feature-icon"></i>
                        <h5>实时监控</h5>
                        <p>实时监控车辆运行状态，包括车速、里程、电池状态等关键指标</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4 text-center mb-4">
                <div class="card h-100">
                    <div class="card-body">
                        <i class="bi bi-graph-up feature-icon"></i>
                        <h5>趋势分析</h5>
                        <p>基于周期型快照数据，分析车辆性能变化趋势和异常模式</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4 text-center mb-4">
                <div class="card h-100">
                    <div class="card-body">
                        <i class="bi bi-shield-check feature-icon"></i>
                        <h5>安全预警</h5>
                        <p>监控电池温度、电压等关键参数，及时发现潜在安全隐患</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 数据说明 -->
        <div class="card mt-4">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">
                    <i class="bi bi-info-circle"></i> 数据说明
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>事务型事实表指标：</h6>
                        <ul>
                            <li><strong>车速</strong>：实时车速数据，单位km/h</li>
                            <li><strong>里程</strong>：累计行驶里程，单位km</li>
                            <li><strong>电压/电流</strong>：电池系统实时电压和电流</li>
                            <li><strong>档位</strong>：当前车辆档位状态</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6>周期型快照指标：</h6>
                        <ul>
                            <li><strong>电池电量(SOC)</strong>：电池剩余电量百分比</li>
                            <li><strong>电池温度</strong>：各电池包温度监控</li>
                            <li><strong>电机状态</strong>：电机运行状态和温度</li>
                            <li><strong>告警信息</strong>：系统告警级别和类型</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 详情模态框 -->
    <div class="modal fade" id="detailModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">车辆详细信息</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="modalBody">
                </div>
            </div>
        </div>
    </div>

    <!-- 配置模态框 -->
    <div class="modal fade" id="configModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="bi bi-gear"></i> 平台配置
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>数据配置</h6>
                            <div class="mb-3">
                                <label class="form-label">分页大小</label>
                                <input type="number" class="form-control" id="pageSizeInput" min="10" max="200">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">数据刷新间隔 (秒)</label>
                                <input type="number" class="form-control" id="refreshIntervalInput" min="5" max="300">
                            </div>
                            <div class="mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="realTimeCheck">
                                    <label class="form-check-label">启用实时数据更新</label>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h6>显示配置</h6>
                            <div class="mb-3">
                                <label class="form-label">主题</label>
                                <select class="form-select" id="themeSelect">
                                    <option value="default">默认主题</option>
                                    <option value="dark">深色主题</option>
                                    <option value="light">浅色主题</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">语言</label>
                                <select class="form-select" id="languageSelect">
                                    <option value="zh-CN">简体中文</option>
                                    <option value="en-US">English</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="col-md-6">
                            <h6>告警阈值</h6>
                            <div class="mb-3">
                                <label class="form-label">电池低电量警告 (%)</label>
                                <input type="number" class="form-control" id="lowSOCInput" min="0" max="50">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">电池高温警告 (°C)</label>
                                <input type="number" class="form-control" id="highTempInput" min="40" max="100">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h6>性能配置</h6>
                            <div class="mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="virtualScrollCheck">
                                    <label class="form-check-label">启用虚拟滚动</label>
                                </div>
                            </div>
                            <div class="mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="lazyLoadingCheck">
                                    <label class="form-check-label">启用懒加载</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" onclick="saveConfig()">保存配置</button>
                    <button type="button" class="btn btn-outline-secondary" onclick="resetConfig()">重置默认</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="config.js"></script>
    <script src="script.js"></script>
</body>
</html>
